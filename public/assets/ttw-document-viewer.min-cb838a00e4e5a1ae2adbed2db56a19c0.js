!function(e){function t(t,n){function a(){return p.update(),o(),p}function i(){y.obj.css(b,c/f.ratio),v.obj.css(b,-c),x.start=y.obj.offset()[b];var e=j.toLowerCase();f.obj.css(e,m[n.axis]),m.obj.css(e,m[n.axis]),y.obj.css(e,y[n.axis])}function o(){y.obj.bind("mousedown",s),y.obj[0].ontouchstart=function(e){return e.preventDefault(),y.obj.unbind("mousedown"),s(e.touches[0]),!1},m.obj.bind("mouseup",l),n.scroll&&this.addEventListener?(u[0].addEventListener("DOMMouseScroll",r,!1),u[0].addEventListener("mousewheel",r,!1)):n.scroll&&(u[0].onmousewheel=r)}function s(t){x.start=g?t.pageX:t.pageY;var n=parseInt(y.obj.css(b));return w.start="auto"==n?0:n,e(document).bind("mousemove",l),document.ontouchmove=function(t){e(document).unbind("mousemove"),l(t.touches[0])},e(document).bind("mouseup",d),y.obj.bind("mouseup",d),y.obj[0].ontouchend=document.ontouchend=function(t){e(document).unbind("mouseup"),y.obj.unbind("mouseup"),d(t.touches[0])},!1}function r(t){if(!(v.ratio>=1)){var t=t||window.event,a=t.wheelDelta?t.wheelDelta/120:-t.detail/3;c-=a*n.wheel,c=Math.min(v[n.axis]-h[n.axis],Math.max(0,c)),y.obj.css(b,c/f.ratio),v.obj.css(b,-c),t=e.event.fix(t),t.preventDefault()}}function d(){return e(document).unbind("mousemove",l),e(document).unbind("mouseup",d),y.obj.unbind("mouseup",d),document.ontouchmove=y.obj[0].ontouchend=document.ontouchend=null,!1}function l(e){return v.ratio>=1||(w.now=Math.min(m[n.axis]-y[n.axis],Math.max(0,w.start+((g?e.pageX:e.pageY)-x.start))),c=w.now*f.ratio,v.obj.css(b,-c),y.obj.css(b,w.now)),!1}var c,p=this,u=t,h={obj:e(".viewport",t)},v={obj:e(".scroll-content",t)},f={obj:e(".scrollbar",t)},m={obj:e(".track",f.obj)},y={obj:e(".thumb",f.obj)},g="x"==n.axis,b=g?"left":"top",j=g?"Width":"Height",w={start:0,now:0},x={};return this.update=function(e){h[n.axis]=h.obj[0]["offset"+j],v[n.axis]=v.obj[0]["scroll"+j],v.ratio=h[n.axis]/v[n.axis],console.log(v.ratio,h[n.axis],v[n.axis]),f.obj.toggleClass("disable",v.ratio>=1),m[n.axis]="auto"==n.size?h[n.axis]:n.size,y[n.axis]=Math.min(m[n.axis],Math.max(0,"auto"==n.sizethumb?m[n.axis]*v.ratio:n.sizethumb)),f.ratio="auto"==n.sizethumb?v[n.axis]/m[n.axis]:(v[n.axis]-h[n.axis])/(m[n.axis]-y[n.axis]),c="relative"==e&&v.ratio<=1?Math.min(v[n.axis]-h[n.axis],Math.max(0,c)):0,c="bottom"==e&&v.ratio<=1?v[n.axis]-h[n.axis]:isNaN(parseInt(e))?c:parseInt(e),i()},a()}e.tiny=e.tiny||{},e.tiny.scrollbar={options:{axis:"y",wheel:40,scroll:!0,size:"auto",sizethumb:"auto"}},e.fn.tinyscrollbar=function(n){var n=e.extend({},e.tiny.scrollbar.options,n);return this.each(function(){e(this).find(".scrollbar").length||e(this).append('<div class="scrollbar"><div class="track"><div class="thumb"><div class="end"></div></div></div></div>'),e(this).data("tsb",new t(e(this),n))}),this},e.fn.tinyscrollbar_update=function(t){return e(this).data("tsb").update(t)},e.fn.tinyscrollbar_destroy=function(){var t=e(this);return t.removeData("tsb"),t.find(".scrollbar").remove()}}(jQuery),function(e){e.fn.paddedWidth=function(t){return this.each(function(){if(t){var n,a=e(this);n=parseInt(a.css("padding-left"),10)+parseInt(a.css("padding-right"),10),a.width(t-n)}}),this},e.fn.paddedHeight=function(t){return this.each(function(){if(t){var n,a=e(this);n=parseInt(a.css("padding-top"),10)+parseInt(a.css("padding-bottom"),10),a.height(t-n)}}),this},e.fn.verticalPadding=function(){return parseInt(this.css("padding-top"),10)+parseInt(this.css("padding-bottom"),10)},e.fn.imagesLoaded=function(e){var t=this.filter("img"),n=t.length,a="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";return t.bind("load.imgloaded",function(){--n<=0&&this.src!==a&&(t.unbind("load.imgloaded"),e.call(t,this))}).each(function(){if(this.complete||void 0===this.complete){var e=this.src;this.src=a,this.src=e}}),this}}(jQuery),function(e){var t=function(t){function n(n){var s=e.extend({},t,n);if(a=[],s.path){var r={};e.each(i,function(t,n){var a=[];e.each(n,function(e,t){a.push(s.path+t)}),r[t]=a}),i=r}o[s.dependency]()?s.callback():yepnope({load:i[s.dependency],complete:function(){o[s.dependency]()?e.isFunction(s.callback)&&s.callback():s.errorHandler("There was an error loading the dependency ("+i[s.dependency]+") Please check your options.path value")}})}var a,i,o;return i={pdfjs:["../../libs/pdfjs/compatibility.js","../../libs/pdfjs/pdf.js"],prettify:["/libs/google-code-prettify/prettify.js","/libs/google-code-prettify/prettify.css"],flowplayer:["/libs/flowplayer/flowplayer-3.2.6.min.js"],jplayer:["/libs/jPlayer/jquery.jplayer.min.js"]},yepnope.errorTimeout=t.errorTimeout||4e3,o={pdfjs:function(){return"undefined"!=typeof PDFJS},prettify:function(){return"undefined"!=typeof prettyPrint},flowplayer:function(){return"undefined"!=typeof flowplayer},jplayer:function(){return"undefined"!=typeof e.jPlayer}},{loadDependency:n}},n=function(n,a){function i(){var i='<div class="document-viewer-wrapper dv-markup clearfix"><div class="document-viewer-outer dv-markup clearfix"><div class="document-viewer dv-markup clearfix"></div></div><div class="dv-sheet sheet1"></div><div class="dv-sheet sheet2"></div></div>';n.append(i),j=n.find(L.wrapper),w=n.find(L.outer),x=n.find(L.anchor),T="document-viewer"+(new Date).getTime(),x.attr("id",T),B=e.extend(!0,{},S,a),x.html(B.emptyText),p(B),P=new t({path:B.path,errorHandler:s})}function o(t){var n=!1;return"pdf"===t?n="pdf":"txt"===t?n="txt":-1!==e.inArray(t,F)?n="code":-1!==e.inArray(t,M)?n="video":-1!==e.inArray(t,k)?n="audio":-1!==e.inArray(t,I)&&(n="image"),n}function s(e){B.debug&&window.console&&console.log("DOCUMENT VIEWER: "+e)}function r(e){var t=/(?:\.([^.]+))?$/;return t.exec(e)[1]}function d(e){"txt"===e||"code"===e?(j.addClass(l("scrollable")),w.addClass(l("viewport")),x.addClass(l("scrollContent")),j.tinyscrollbar()):(j.removeClass(l("scrollable")),w.removeClass(l("viewport")),x.removeClass(l("scrollContent")),j.tinyscrollbar_destroy())}function l(e){return L[e]?L[e].substr(1):""}function c(e,t){var n;return n="pdf"===t||"txt"===t||"code"===t?"string"!=typeof e.height?e.height:1.3*e.width:"video"===t?"string"!=typeof e.height?e.height:Math.round(e.width/16*9):"image"===t?e.height:"audio"===t?0:"auto"}function p(e){var t=e.type;e.width=e.width||S.width,e.height=c(e,t),j.paddedWidth(e.width+2).find(".dv-markup").paddedWidth(e.width),"pdf"==t?x.paddedHeight(e.height).parent().paddedHeight(e.height):"txt"===t||"code"===t?x.parent().paddedHeight(e.height):x.height("auto").parent().height("auto")}function u(t,n){n&&e.isFunction(n)&&x.bind(t,n)}function h(e){x.trigger(e)}function v(e,t){B.autoLoadDependencies?P.loadDependency({dependency:e,callback:t}):t()}function f(t,n){var a;switch(a=e.extend(!0,{},B,n),"undefined"==typeof a.extension&&(a.extension=r(t)),"undefined"==typeof a.type&&(a.type=o(a.extension)),A=a.type,C=t,j.removeClass("pdf code txt video audio image").addClass(A),a.loadEventId=(new Date).getTime()+"-"+Math.floor(1e5*Math.random())+1,u(a.loadEventId,a.callback),p(a),x.html(""),N.css("top",B.height/2-18),x.append(N),A){case"pdf":{new H(t,a)}break;case"code":case"txt":if(B.enableTextAndCode===!0){new O(t,a)}else g(1,"Invalid File Type. Please set enableTextAndCode option to true"),s("Invalid File Type. Please set enableTextAndCode option to true");break;case"video":{new R(t,a)}break;case"audio":{new W(t,a)}break;case"image":{new Q(t,a)}break;default:g(1,"Invalid File Type"),s("Invalid File Type")}"txt"!==A&&"code"!==A&&d(A),"pdf"===A&&h(a.loadEventId)}function m(){x.html(B.emptyText),p(B),d()}function y(e){return o(r(e))}function g(e,t){var n="<br/><span>"+B.serverResponseText+" "+e+" ("+t+")</span>";x.html('<div class="dv-error">'+B.errorText+A+n+"</div>"),s("Error loading file ("+C+"). Please make sure that the path is correct")}function b(){N.remove()}var j,w,x,P,A,C,T,F=["bsh","c","cc","cpp","cs","csh","css","cyc","cv","htm","html","java","js","m","mxml","perl","php","pl","pm","py","rb","sh","xhtml","xml","xsl","sql","vb"],I=["png","jpg","jpeg","gif"],k=["mp3","m4a","oga","webma","fla"],D=["m4v","ogv","ogg","webmv","flv"],E=["mpg","mpeg","mov","divx","avi","wmv"],M=D.concat(E),z=D.concat(k),S={width:500,height:"auto",debug:!1,autoplay:!0,autoLoadDependencies:!0,enableTextAndCode:!0,jPlayer:{},emptyText:'<div class="document-viewer-empty-text">No Document Loaded</div>',unsupportedBrowserText:'<div class="document-viewer-empty-text">This document can not be opened in this browser. Please upgrade.</div>',errorText:"An error occurred while loading the ",serverResponseText:"Unexpected server response of ",path:"documentViewer/"},L={scrollable:".scrollable",viewport:".viewport",scrollContent:".scroll-content",wrapper:".document-viewer-wrapper",outer:".document-viewer-outer",anchor:".document-viewer"},B={},N=e('<div class="dv-loading"></div>'),H=function(t,n){function a(){return!!document.createElement("canvas").getContext}function i(e){x.append(l),PDFJS.workerSrc=n.path+"../../libs/pdfjs/pdf.js",PDFJS.getPdf({url:e,error:function(e){g(e.target.status,e.target.statusText)}},function(e){r=new PDFJS.PDFDoc(e),o(d)})}function o(e){x.find("canvas").remove(),x.append(s(e))}function s(e){var t,n,a;return t=r.getPage(e),n=document.createElement("canvas"),n.id="page"+e,a=n.getContext("2d"),n.width=x.width(),n.height=x.height(),t.startRendering(a,function(){b()}),n}var r,d=1,l=e('<div class="pdf-menu"><div class="prev-page" >\u4e0a\u4e00\u9875</div><div class="next-page">\u4e0b\u4e00\u9875</div><div class="go-to-page">\u8df3\u8f6c\u5230 <input></div></div>');return l.on("click",".prev-page",function(){d>1&&(d-=1,o(d))}),l.on("click",".next-page",function(){d<r.numPages&&(d+=1,o(d))}),l.on("keyup","input",function(){var t=e(this).val();t>0&&t<=r.numPages&&o(t)}),a()?(v(["pdfjs"],function(){i(t)}),{load:i,setPage:o}):void x.html(n.unsupportedBrowserText)},O=function(t,n){e.ajax({url:n.path+"libs/getContents.php",type:"POST",data:{file:t},success:function(t){if(t=e.parseJSON(t),"success"===t.status){var a=e('<pre class="prettyprint linenums">'+t.response+"</pre>").css("opacity",0);b(),x.append(a),a.animate({opacity:1}),d(n.type),v(["prettify"],function(){"code"===n.type&&prettyPrint()}),h(n.loadEventId)}else g("404","Not Found")},error:function(){g()}})},R=function(t,n){var a;a=-1!==e.inArray(n.extension,z)?new W(t,n):new J(t,n)},W=function(t,n){function a(){var t,a,i;t='<div class="ttw-video-player"><div class="jPlayer-container"></div><div class="clear"></div><div class="player jp-interface"><div class="player-controls"><div class="play jp-play button"></div><div class="pause jp-pause button"></div><div class="progress-wrapper"><div class="progress-bg"><div class="progress jp-seek-bar"><div class="elapsed jp-play-bar"></div></div></div></div><div class="volume-wrapper"><div class="volume jp-volume-bar"><div class="volume-value jp-volume-bar-value"></div></div></div></div><!-- These controls aren\'t used by this plugin, but jPlayer seems to require that they exist --><span class="unused-controls"><span class="previous jp-previous"></span><span class="next jp-next"></span><span class="jp-video-play"></span><span class="jp-stop"></span><span class="jp-mute"></span><span class="jp-unmute"></span><span class="jp-volume-max"></span><span class="jp-current-time"></span><span class="jp-duration"></span><span class="jp-repeat"></span><span class="jp-repeat-off"></span><span class="jp-gui"></span><span class="jp-restore-screen"></span><span class="jp-full-screen"></span><span class="jp-no-solution"></span></span></div><div class="clear"></div></div>',a=e(t).css({opacity:0}).appendTo(x),i=x.width(),o.size.width=i,a.width(i).find(l.jPlayerInterface+", "+l.jPlayerContainer).paddedWidth(i),c?a.height(parseInt(n.height,10)).find(l.jPlayerContainer).height(parseInt(n.height,10)-34):a.find(l.jPlayerContainer).height(0),a.animate({opacity:1})}function i(){c=-1!==e.inArray(n.type,D),o=e.extend(!0,{},r,n.jPlayer),b(),a(),d=x.find(".jPlayer-container"),d.bind(e.jPlayer.event.ready,function(){var e={};e[n.extension]=t,d.jPlayer("setMedia",e),s("jPlayer Ready"),n.autoplay&&d.jPlayer("play")}),d.bind(e.jPlayer.event.loadstart,function(){h(n.loadEventId)}),d.bind(e.jPlayer.event.error,function(){g("404","Not Found")}),d.jPlayer(o)}var o,r,d,l,c;l={jPlayer:"#jquery_jplayer",jPlayerContainer:".jPlayer-container",jPlayerInterface:".jp-interface",playlist:".playlist",playing:".playing",progress:".progress-wrapper",volume:".volume-wrapper"},r={swfPath:n.path+"libs/jPlayer",supplied:n.extension,solution:"html, flash",cssSelectorAncestor:l.jPlayerInterface,errorAlerts:n.debug,warningAlerts:n.debug,size:{height:n.height,width:n.width,cssClass:"show-video"},sizeFull:{width:"100%",height:"90%",cssClass:"show-video-full"}},v(["jplayer"],function(){i()})},J=function(e,t){function n(){x.height(t.height),b(),flowplayer(T,t.path+"libs/flowplayer/flowplayer-3.2.7.swf",{clip:{autoPlay:t.autoplay,autoBuffering:!0,url:e,height:t.height},plugins:{controls:{backgroundColor:"transparent",backgroundGradient:"none",sliderColor:"#FFFFFF",sliderBorder:"1.5px solid rgba(160,160,160,0.7)",volumeSliderColor:"#FFFFFF",volumeBorder:"1.5px solid rgba(160,160,160,0.7)",timeColor:"#ffffff",durationColor:"#535353",tooltipColor:"rgba(255, 255, 255, 0.7)",tooltipTextColor:"#000000"}},onBegin:function(){h(t.loadEventId)},onError:function(e,t){g(e,t)}})}v(["flowplayer"],function(){n()})},Q=function(t,n){var a=e('<img class="dv-image">').css("opacity",0);a.error(function(){g("404","Not Found")}),a.attr("src",t),a.imagesLoaded(function(){b(),x.append(a),a.animate({opacity:1}),h(n.loadEventId)})};return i(),{load:f,close:m,getDocumentType:y}};e.fn.documentViewer=function(e){var t=new n(this,e);return this.data("document-viewer",t),t}}(jQuery);